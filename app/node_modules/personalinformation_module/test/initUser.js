//test environment init
var expect = require('chai').expect;
var directory = '../../';

var config = {
    modules: []
};

//module load area
config.modules['personalinformation_module'] = (require(directory + './personalinformation_module'))(config);
config.modules['saferman'] = (require(directory + './saferman'))(config);

describe('initUser',function(){

    before(function(done){
        config.modules['saferman'].sql('DELETE FROM PersonalInformation',function(){
            done();
        });
    });

    it('init user0',function(done){
        config.modules['personalinformation_module'].initUser('testman',function(){
            var sql = 'SELECT Name FROM PersonalInformation';

            config.modules['saferman'].sql(sql,handleSQLResults);

            function handleSQLResults(sqlResults){
                var RegExpToMatch = new RegExp('testman');
                var isMatchSucceed = (RegExpToMatch.exec(sqlResults[0].Name)!=null);

                expect(sqlResults.length).to.be.equal(1);
                expect(isMatchSucceed).to.be.a('boolean');
                expect(isMatchSucceed).to.be.equal(true);

                done();
            }
        });

    });

    it('init user1',function(done){
        config.modules['personalinformation_module'].initUser('sky',function(){
            var sql = 'SELECT Name FROM PersonalInformation';

            config.modules['saferman'].sql(sql,handleSQLResults);

            function handleSQLResults(sqlResults){
                var RegExpToMatch = new RegExp('sky');
                var isMatchSucceed = (RegExpToMatch.exec(sqlResults[1].Name)!=null);

                expect(sqlResults.length).to.be.equal(2);
                expect(isMatchSucceed).to.be.a('boolean');
                expect(isMatchSucceed).to.be.equal(true);

                done();
            }
        });

    });

})
