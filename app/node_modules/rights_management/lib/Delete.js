module.exports = Delete;

function Delete(ID,right,callback){

    var config = this.config;

    if(isRightStringLegal(right) == false){
        executeCallback(false);
        return;
    }

    var sql = 'SELECT Rights FROM RightsTable WHERE ID=' + ID;

    config.modules['saferman'].sql(sql,handleResultsOfSQL);

    function handleResultsOfSQL(sqlResults){

        if(sqlResults != null){
            DeleteRightForUser();
        }else{
            executeCallback(false);
        }

        function DeleteRightForUser(){
            var RightsOfUserAfterDelete = sqlResults[0].Rights.replace('|' + right,'');
            sql = "UPDATE RightsTable SET Rights='" + RightsOfUserAfterDelete +  "' WHERE ID=" + ID;

            config.modules['saferman'].sql(sql,executeCallback);
        }

    }

    function executeCallback(argumentOfCallback){
        if(callback!=undefined)
            callback(argumentOfCallback);
    }

    function isRightStringLegal(right){
        if(right != 'publish'
            && right != 'answer'
            && right != 'view'
            && right != 'view_personal_infromation'
        ){
            return false;
        }else{
            return true;
        }
    }
}
